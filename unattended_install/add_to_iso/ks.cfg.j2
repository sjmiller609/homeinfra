#Generated by Kickstart Configurator
#platform=AMD64 or Intel EM64T

#System language
lang en_US
#Language modules to install
langsupport en_US
#System keyboard
keyboard us
#System mouse
mouse
#System timezone
timezone America/New_York
#Root password
rootpw --disabled
#Initial user
#TODO: --is-crypted
user {{ username }} --fullname "{{ full_name }}" --password {{ password }}
#Reboot after installation
reboot
#Use text mode install
text
#Install OS instead of upgrade
install
#Use CDROM installation media
cdrom
#System bootloader configuration
bootloader --location=mbr 
#Clear the Master Boot Record
zerombr yes
#Partition clearing information
clearpart --all --initlabel 
#Disk partitioning information
part swap --size 2048 
part /boot --fstype ext4 --size 512 
part / --fstype ext4 --size 1 --grow 
#System authorization infomation
auth  --useshadow  --enablemd5 
#Network information
network --bootproto=dhcp --device=eth0
#Firewall configuration
firewall --enabled --ssh
#Do not configure the X Window System
skipx

# Additional packages to install
%packages
ca-certificates
openssl
python
openssh-server
python-pip
vim
git

# Add your custom post installation script here
%post

# install minimal lightdm before reboot
apt-get install -y xorg
apt-get install -y lightdm-gtk-greeter --no-install-recommends
apt-get install -y lightdm --no-install-recommends
apt-get install -y openbox --no-install-recommends

# set auto log for our user
mkdir -p /etc/lightdm/lightdm.conf
echo "[SeatDefaults]" > /etc/lightdm/lightdm.conf
echo "autlogin-user={{ username }}" >> /etc/lightdm/lightdm.conf

# Set locale
echo 'LANG="en_US.UTF-8"' > /etc/default/locale
echo 'LANGUAGE="en_US:en"' >> /etc/default/locale
echo 'LC_ALL="en_US.UTF-8"' >> /etc/default/locale

# install ansible, set playbook in rc.local
pip install ansible
git clone https://github.com/sjmiller609/homeinfra.git
echo "#!/bin/sh -e" > /etc/rc.local
echo "sudo -u {{ username }} ansible-playbook -i /opt/homeinfra/hosts.yml /opt/homeinfra/{{ playbook_to_run }}" >> /etc/rc.local
echo "exit 0" >> /etc/rc.local

# Clean
apt-get -f -y install
apt-get -y autoremove
apt-get clean
